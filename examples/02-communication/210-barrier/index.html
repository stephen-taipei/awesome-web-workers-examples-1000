<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barrier Synchronization - Web Worker Example #210</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Barrier Synchronization</h1>
            <p class="subtitle">Web Worker Example #210 - Phase-Based Parallel Computation</p>
        </header>

        <main>
            <section class="description">
                <h2>About Barrier Synchronization</h2>
                <p>A Barrier is a synchronization point where all participating threads must arrive before any can proceed. This is essential for parallel algorithms that work in phases, ensuring all workers complete one phase before starting the next.</p>
                <div class="formula-box">
                    <p><strong>Barrier Pattern:</strong></p>
                    <pre class="formula">
Barrier Synchronization Flow:

Thread 1:  ───────■──────────────■──────────────■──→
Thread 2:  ──■───────────────────■────────■─────────→
Thread 3:  ────────■─────────────■─────────────■────→
Thread 4:  ─────■────────────────■──────────■───────→
               ↓                 ↓             ↓
            Phase 1           Phase 2       Phase 3

All threads must reach barrier (■) before any proceed

SharedArrayBuffer Layout:
┌──────────────────────────────────────────┐
│ [0] count     - threads at barrier       │
│ [1] phase     - current phase number     │
│ [2] total     - total thread count       │
│ [3+] results  - per-worker results       │
└──────────────────────────────────────────┘

Barrier Algorithm:
1. Atomically increment count
2. If count < total: wait on phase
3. If count == total:
   - Reset count to 0
   - Increment phase
   - Notify all waiting threads
                    </pre>
                </div>
            </section>

            <section class="controls">
                <h2>Configuration</h2>

                <div class="params-grid">
                    <div class="input-group">
                        <label for="workerCount">Number of Workers:</label>
                        <input type="number" id="workerCount" value="4" min="2" max="8">
                    </div>

                    <div class="input-group">
                        <label for="phaseCount">Number of Phases:</label>
                        <input type="number" id="phaseCount" value="5" min="2" max="10">
                    </div>

                    <div class="input-group">
                        <label for="workVariance">Work Variance (%):</label>
                        <input type="number" id="workVariance" value="50" min="0" max="100">
                    </div>

                    <div class="input-group">
                        <label for="baseWork">Base Work (ms):</label>
                        <input type="number" id="baseWork" value="300" min="100" max="1000">
                    </div>
                </div>

                <div class="button-group">
                    <button id="startBtn" class="btn btn-primary">Start Barrier Demo</button>
                    <button id="resetBtn" class="btn btn-outline">Reset</button>
                </div>
            </section>

            <section class="visualization">
                <h2>Phase Progress</h2>
                <canvas id="barrierCanvas" width="700" height="400"></canvas>
            </section>

            <section id="logSection" class="log-section">
                <h2>Activity Log</h2>
                <div id="logContainer" class="log-container"></div>
            </section>

            <section id="resultContainer" class="result-section hidden">
                <h2>Results</h2>
                <div class="results-grid">
                    <div class="result-item">
                        <span class="result-label">Total Phases</span>
                        <span id="totalPhases" class="result-value">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Total Workers</span>
                        <span id="totalWorkers" class="result-value">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Execution Time</span>
                        <span id="execTime" class="result-value">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Avg Phase Time</span>
                        <span id="avgPhaseTime" class="result-value">-</span>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="result-item">
                        <span class="result-label">Avg Wait Time</span>
                        <span id="avgWaitTime" class="result-value">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Max Wait Time</span>
                        <span id="maxWaitTime" class="result-value">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Total Work Done</span>
                        <span id="totalWork" class="result-value">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Efficiency</span>
                        <span id="efficiency" class="result-value">-</span>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p><a href="../index.html">Back to Examples</a> | Web Workers Example #210</p>
        </footer>
    </div>
    <script src="main.js"></script>
</body>
</html>
