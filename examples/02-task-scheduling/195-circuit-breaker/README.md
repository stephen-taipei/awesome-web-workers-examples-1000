# 熔斷機制 (Circuit Breaker)

此範例展示如何在前端使用 Web Workers 實作熔斷器模式 (Circuit Breaker Pattern)。

## 什麼是熔斷器？

在分散式系統中，當某個服務持續失敗時（例如網路中斷、伺服器過載），如果客戶端持續發送請求，可能會導致：
1.  客戶端資源被耗盡（等待超時）。
2.  服務端壓力更大，無法恢復。
3.  產生連鎖反應，拖垮整個系統。

熔斷器就像電路中的保險絲，當錯誤達到一定閾值時自動「跳閘」(Open)，暫時切斷請求，讓系統有時間自我修復。

## 狀態機說明

本範例實作了標準的三態熔斷器：

1.  **CLOSED (關閉/正常狀態)**
    *   預設狀態，所有請求正常通行。
    *   監控請求失敗率或連續失敗次數。
    *   若達到閾值 (本例為 5 次連續失敗)，切換至 `OPEN`。

2.  **OPEN (開啟/熔斷狀態)**
    *   阻斷所有請求，直接返回錯誤 (Fail Fast)，不浪費資源發送請求。
    *   啟動一個重置計時器 (本例為 5 秒)。
    *   計時結束後，切換至 `HALF-OPEN`。

3.  **HALF-OPEN (半開啟/探測狀態)**
    *   允許有限數量的請求通過 (本例為 1 個) 作為探測。
    *   如果探測請求成功，代表服務已恢復，切換回 `CLOSED`。
    *   如果探測請求失敗，代表服務仍不穩定，切換回 `OPEN` 並重新計時。

## 使用方法

1.  **設定服務穩定性**: 調整下拉選單，模擬後端服務的可靠度 (100%, 70%, 0%)。
2.  **發送請求**: 手動點擊或使用「自動連續發送」。
3.  **觀察狀態變化**:
    *   將穩定性設為 0%，觀察連續失敗 5 次後，狀態變為紅色 `OPEN`。
    *   在 `OPEN` 狀態下，請求會被直接攔截 (黃色日誌)。
    *   等待 5 秒倒數，狀態變為黃色 `HALF-OPEN`。
    *   此時若將穩定性調回 100%，下一個請求成功後，狀態會恢復綠色 `CLOSED`。
