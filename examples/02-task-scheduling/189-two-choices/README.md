# 兩階段選擇 (Power of Two Choices)

此示例演示並比較了隨機負載均衡演算法與「兩階段選擇 (Power of Two Choices)」演算法在伺服器負載分配上的差異。

## 原理

*   **隨機選擇 (Random Choice)**：對於每個新任務，隨機選擇一個伺服器進行分配。這種方法簡單但容易導致某些伺服器過載 (負載不均)，即「長尾效應」。
*   **兩階段選擇 (Power of Two Choices)**：對於每個新任務，隨機選擇 **兩個** 伺服器，並查詢它們當前的負載，然後將任務分配給負載較輕的那個。
    *   這是一個著名的理論結果 (Mitzenmacher, 2001)：僅僅是從選擇 1 個改為選擇 2 個，就可以將最大負載從 $O(\log n)$ 降低到 $O(\log \log n)$。

## 功能

1.  **模擬環境**：模擬 50 台伺服器和連續到達的任務。
2.  **演算法切換**：可以即時切換使用「隨機選擇」或「兩階段選擇」。
3.  **參數調整**：可以調整任務到達率 (Arrival Rate) 和任務平均耗時 (Task Duration) 來改變系統壓力。
4.  **視覺化**：
    *   **長條圖**：即時顯示每台伺服器的當前負載 (佇列長度)。
    *   **顏色編碼**：綠色 (低負載) -> 黃色 (中負載) -> 紅色 (高負載)。
5.  **統計指標**：
    *   **最大負載**：系統中負載最重的伺服器的任務數。
    *   **平均負載**：所有伺服器的平均任務數。
    *   **負載變異數**：負載分布的不均勻程度 (越低越好)。

## 觀察重點

1.  選擇 **隨機選擇 (Random)** 並開始模擬。等待一段時間，你會觀察到負載分布呈現參差不齊的狀態，有些伺服器可能會有很高的堆積 (紅色)，而有些則很空閒。觀察「最大負載」和「負載變異數」。
2.  將演算法切換為 **兩階段選擇 (Power of Two)**。你會發現長條圖變得非常平滑，所有伺服器的負載都非常接近平均值，最大負載顯著降低。

## 技術重點

*   **Web Worker**：模擬邏輯 (任務生成、伺服器處理、負載計算) 完全在 Worker 中運行，主執行緒僅負責渲染圖表。
*   **Canvas**：使用 Canvas 高效繪製動態長條圖。
