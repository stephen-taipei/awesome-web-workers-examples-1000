# 自適應負載均衡 (Adaptive Load Balancing)

此示例模擬並比較了靜態負載均衡策略與自適應 (動態) 負載均衡策略在面對網路波動和伺服器效能差異時的表現。

## 功能

1.  **多種均衡策略**：
    *   **輪詢 (Round Robin)**：按順序分配請求，不考慮伺服器狀態。
    *   **隨機 (Random)**：隨機分配。
    *   **最少連接 (Least Connections)**：分配給當前處理中請求數最少的伺服器。
    *   **自適應 (Adaptive)**：基於「最小響應時間」和當前負載的加權分數來選擇最佳伺服器。會自動避開回應慢的伺服器。
2.  **故障與干擾模擬**：
    *   **手動延遲 (Add Lag)**：可以為特定伺服器增加額外的網路延遲，觀察負載均衡器如何反應。
    *   **故障模擬 (Offline)**：可以手動關閉特定伺服器，測試故障轉移。
3.  **即時監控**：
    *   **儀表板**：顯示總請求數、平均延遲、錯誤率。
    *   **視覺化**：顯示每台伺服器的狀態、活躍連接數、當前延遲估計。

## 使用場景演示

1.  **基準測試**：
    *   選擇 **Round Robin**，開始模擬。
    *   所有伺服器負載應該大致相同。
2.  **效能差異模擬**：
    *   在模擬進行中，將 **Server 1** 的延遲 (Add Lag) 拉高到 300ms。
    *   **Round Robin** 會繼續向 Server 1 發送相同數量的請求，導致整體「平均響應時間」顯著上升，Server 1 的活躍連接數會堆積 (因為處理慢)。
3.  **自適應效果**：
    *   將策略切換為 **Adaptive**。
    *   你會看到負載均衡器開始減少發送給 Server 1 的流量 (因為它的響應時間變長了)，並將流量轉移到其他健康的伺服器。
    *   結果是 Server 1 的堆積減少，整體的「平均響應時間」會比 Round Robin 情況下低很多。
4.  **故障轉移**：
    *   將 Server 2 設為 **Offline**。
    *   所有算法都應檢測到並停止向其發送流量 (基礎健康檢查)，但自適應算法能更平滑地處理這種轉換。

## 技術重點

*   **Web Worker**：模擬請求生成、網路延遲、伺服器處理邏輯和負載均衡算法。
*   **EMA (Exponential Moving Average)**：自適應算法使用指數移動平均來估算伺服器的響應時間，這樣既能平滑波動，又能對變化做出反應。
