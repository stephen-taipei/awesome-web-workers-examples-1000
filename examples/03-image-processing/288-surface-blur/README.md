# 表面模糊 (Surface Blur)

本範例展示如何使用 Web Workers 實現影像的表面模糊效果。

## 功能簡介

表面模糊是一種邊緣保持濾波器，它能夠模糊影像的平坦區域，同時保留明顯的邊緣。這使得它非常適合用於皮膚磨皮、去除雜訊等應用。

### 主要功能

1.  **半徑控制**：設定模糊的核心大小，影響模糊的範圍。
2.  **閾值控制**：設定判定邊緣的顏色差異閾值。
    -   低閾值：只模糊顏色非常接近的區域，保留大部分細節。
    -   高閾值：容許較大的顏色差異，模糊效果更強，接近普通模糊。
3.  **並行處理**：利用 Web Workers 加速計算密集的像素比對運算。

## 技術實現

### 模糊算法

對於每個像素，計算其周圍半徑內的鄰域像素的加權平均。權重取決於鄰域像素與中心像素的顏色差異：

`Weight = max(0, 1 - abs(Pixel - Center) / (2.5 * Threshold))`

-   如果顏色差異很小，權重接近 1，該鄰域像素參與平均計算（導致模糊）。
-   如果顏色差異很大（超過閾值），權重接近 0，該鄰域像素被忽略（保留邊緣）。

這種算法與雙邊濾波 (Bilateral Filter) 非常相似，但計算上稍微簡化了一些（使用線性衰減而非高斯衰減）。

### Web Worker 處理

-   **主執行緒**：負責 UI 與 Canvas 顯示。
-   **Worker 執行緒**：並行執行每個像素的鄰域遍歷與加權平均計算。

## 使用方法

1.  上傳圖片或載入範例。
2.  調整「模糊半徑」設定模糊範圍。
3.  調整「邊緣閾值」控制保留細節的程度。
4.  點擊「套用模糊」。

## 效能考量

-   計算複雜度為 `O(Width * Height * Radius^2)`。
-   因為需要對每個像素的每個通道分別計算權重，計算量比普通的高斯模糊大得多，且難以使用可分離卷積優化。
-   使用 Web Workers 是保持頁面響應的關鍵。
