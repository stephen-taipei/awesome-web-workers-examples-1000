# 雙邊濾波 (Bilateral Filter)

本範例展示如何使用 Web Workers 實現影像的雙邊濾波效果。

## 功能簡介

雙邊濾波是一種非線性的濾波器，它在平滑影像的同時能夠非常有效地保留邊緣。這使得它成為圖像去噪、磨皮美顏等應用的首選算法之一。

### 主要功能

1.  **空間 Sigma (Space σ)**：控制空間域的高斯函數標準差。值越大，模糊的幾何範圍越大。
2.  **顏色 Sigma (Color σ)**：控制顏色域的高斯函數標準差。值越大，容許的顏色差異越大（越接近高斯模糊）；值越小，只有顏色非常接近的像素才會相互影響（邊緣保留越強）。
3.  **並行處理**：雙邊濾波計算量非常大（無法像高斯模糊那樣進行 XY 分離優化），使用 Web Workers 至關重要。

## 技術實現

### 濾波算法

雙邊濾波的權重由兩部分組成：

1.  **空間權重 (Domain Kernel)**：`exp( -distance^2 / (2 * sigmaSpace^2) )`
    -   這就是普通高斯模糊使用的權重，距離中心越近權重越大。
2.  **顏色權重 (Range Kernel)**：`exp( -colorDiff^2 / (2 * sigmaColor^2) )`
    -   這取決於像素值的差異。顏色越接近，權重越大。

最終權重 = 空間權重 * 顏色權重。

在平坦區域，顏色差異小，顏色權重接近 1，濾波器表現像高斯模糊。
在邊緣區域，顏色差異大，顏色權重接近 0，鄰域像素不參與平均，從而保持邊緣清晰。

### Web Worker 處理

-   **主執行緒**：負責 UI 與 Canvas 顯示。
-   **Worker 執行緒**：
    1.  預計算空間權重模板。
    2.  遍歷每個像素，計算每個鄰域像素的顏色權重。
    3.  結合兩種權重進行加權平均。

## 使用方法

1.  上傳圖片或載入範例。
2.  調整「空間 Sigma」設定模糊半徑。
3.  調整「顏色 Sigma」設定保邊程度。
4.  點擊「套用濾波」。

## 效能考量

-   雙邊濾波是非常消耗資源的算法。計算複雜度為 `O(Width * Height * Radius^2)`。
-   因為權重依賴於圖像內容，無法預計算完整的卷積核。
-   對於大圖像或大半徑，處理時間可能會很長，因此進度回報功能很重要。
