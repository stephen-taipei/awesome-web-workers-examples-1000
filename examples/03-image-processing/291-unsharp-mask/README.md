# USM 銳化 (Unsharp Mask)

本範例展示如何使用 Web Workers 實現影像的 USM 銳化 (Unsharp Mask) 效果。

## 功能簡介

USM (Unsharp Mask) 是一種經典的影像銳化技術，儘管名稱中包含 "Unsharp" (不清晰)，但它實際上是用來增強清晰度的。它的原理是利用影像的模糊版本來檢測邊緣，然後增強這些邊緣的對比度。

### 主要功能

1.  **強度 (Amount)**：控制銳化的程度。這是一個百分比值，表示將多少邊緣對比度加回原圖。
2.  **半徑 (Radius)**：控制用於檢測邊緣的高斯模糊半徑。較大的半徑會增強較粗的邊緣（增加整體對比度），較小的半徑會增強細節。
3.  **閾值 (Threshold)**：控制最小亮度差異。只有當原圖與模糊圖的差異大於此值時才會應用銳化。這可以防止在平坦區域（如天空或皮膚）增強噪聲。

## 技術實現

### 算法流程

1.  **生成模糊遮罩**：對原始圖像進行高斯模糊。
2.  **計算差異**：計算原始圖像與模糊圖像之間的差異 (`Original - Blurred`)。這個差異圖實際上包含了圖像的高頻部分（邊緣）。
3.  **應用銳化**：將差異圖乘以強度係數後加回原圖。
    -   `Result = Original + (Original - Blurred) * Amount`
4.  **閾值控制**：如果 `|Original - Blurred| < Threshold`，則不進行銳化，直接輸出原圖像素。

### Web Worker 處理

-   **主執行緒**：負責 UI 與 Canvas 顯示。
-   **Worker 執行緒**：
    1.  執行可分離的高斯模糊運算 (水平 + 垂直)。
    2.  執行 USM 混合運算。
    3.  回傳處理後的結果。

## 使用方法

1.  上傳圖片或載入範例。
2.  調整「強度」設定銳化量。
3.  調整「半徑」設定邊緣寬度。
4.  調整「閾值」以避免噪聲被放大。
5.  點擊「套用 USM」。

## 效能考量

-   USM 的主要開銷在於高斯模糊步驟。
-   本範例實現了可分離的高斯模糊 (`O(Width * Height * Radius)`)，比直接卷積 (`O(Width * Height * Radius^2)`) 快得多。
-   使用 Web Workers 可確保 UI 不被凍結。
