# 鏡頭模糊 (Lens Blur)

本範例展示如何使用 Web Workers 實現影像的鏡頭模糊 (散景) 效果。

## 功能簡介

鏡頭模糊用於模擬真實相機鏡頭的成像特性，特別是淺景深時背景失焦產生的散景 (Bokeh) 效果。與高斯模糊的平滑效果不同，鏡頭模糊會保留高光點的形狀 (通常是光圈的形狀)。

### 主要功能

1.  **半徑控制**：設定模糊的程度。
2.  **亮度增強**：模擬過曝的高光擴散，使散景更明亮動人。
3.  **光圈形狀**：可選擇不同的光圈形狀 (圓形、六邊形、星形、心形)。
4.  **核心預覽**：即時預覽當前光圈形狀的卷積核。

## 技術實現

### 卷積核生成

鏡頭模糊使用一個二值的形狀核心 (Shape Kernel)，而不是高斯核心。這意味著核心內的權重是均勻的 (Flat)，這使得失焦的點會擴散成核心的形狀。

1.  根據半徑建立一個矩陣。
2.  根據選定的形狀 (如圓形)，判斷矩陣中的點是否在形狀內。
3.  在形狀內的點設為 1，形狀外設為 0。
4.  正規化核心。

### 高光處理

為了模擬真實的散景，我們對圖像進行預處理，檢測並增強高光區域。這樣在卷積後，高光區域會形成明亮且清晰的光斑，而不是單調的模糊。

### Web Worker 處理

-   **主執行緒**：處理 UI 與預覽。
-   **Worker 執行緒**：
    1.  生成形狀核心。
    2.  對原始圖像進行高光增強預處理。
    3.  執行卷積運算。

## 使用方法

1.  上傳圖片或載入範例 (夜景圖片效果最佳)。
2.  調整「模糊半徑」。
3.  調整「亮度增強」以獲得更漂亮的散景。
4.  選擇不同的「光圈形狀」。
5.  點擊「套用模糊」。

## 效能考量

-   鏡頭模糊的計算量隨半徑平方增長，大半徑時運算較慢。
-   使用 Web Workers 可確保 UI 不被凍結，並能提供進度回饋。
