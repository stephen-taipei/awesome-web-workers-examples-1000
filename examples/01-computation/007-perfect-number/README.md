# #007 完美數檢測器 (Perfect Number Checker)

> 使用 Web Worker 檢測完美數、盈數、虧數，探索梅森質數與完美數的關係

[![Difficulty: Beginner](https://img.shields.io/badge/難度-初級-green.svg)](#)
[![Worker: Dedicated](https://img.shields.io/badge/Worker-Dedicated-blue.svg)](#)
[![Category: Computation](https://img.shields.io/badge/分類-計算密集型-orange.svg)](#)

---

## 功能說明

本範例展示如何使用 Web Worker 檢測完美數及相關數論概念。

### 主要功能

- 檢測數字是完美數、盈數還是虧數
- 詳細分析數字的因數特性
- 搜尋範圍內的所有完美數
- 分類統計範圍內的數字
- 探索梅森完美數
- 檢測親和數、半完美數、奇異數

---

## 完美數介紹

### 定義

完美數 (Perfect Number) 是指所有真因數（除自身外的因數）之和等於自身的正整數。

```
6 = 1 + 2 + 3          ✓ 完美數
28 = 1 + 2 + 4 + 7 + 14  ✓ 完美數
496 = 1 + 2 + 4 + 8 + 16 + 31 + 62 + 124 + 248  ✓ 完美數
```

### 數字分類

| 分類 | 定義 | 範例 |
|------|------|------|
| **完美數** | σ(n) - n = n | 6, 28, 496, 8128 |
| **虧數 (Deficient)** | σ(n) - n < n | 1, 2, 3, 4, 5, 7, 8... |
| **盈數 (Abundant)** | σ(n) - n > n | 12, 18, 20, 24, 30... |

其中 σ(n) 表示 n 的因數和（包含 n 本身）。

---

## 已知完美數

### 前 8 個完美數

| # | 完美數 | 位數 | 對應梅森質數 |
|---|--------|------|--------------|
| 1 | 6 | 1 | M₂ = 3 |
| 2 | 28 | 2 | M₃ = 7 |
| 3 | 496 | 3 | M₅ = 31 |
| 4 | 8,128 | 4 | M₇ = 127 |
| 5 | 33,550,336 | 8 | M₁₃ = 8191 |
| 6 | 8,589,869,056 | 10 | M₁₇ = 131071 |
| 7 | 137,438,691,328 | 12 | M₁₉ = 524287 |
| 8 | 2,305,843,008,139,952,128 | 19 | M₃₁ |

### 重要事實

- 截至 2024 年，已發現 **51 個**完美數
- 所有已知完美數都是**偶數**
- 是否存在奇完美數仍是未解之謎

---

## 梅森質數與完美數

### 歐幾里得-歐拉定理

若 2ᵖ - 1 是質數（梅森質數），則：

```
2^(p-1) × (2^p - 1)
```

是完美數。反之，每個偶完美數都具有此形式。

### 範例

```
p = 2: 2¹ × (2² - 1) = 2 × 3 = 6
p = 3: 2² × (2³ - 1) = 4 × 7 = 28
p = 5: 2⁴ × (2⁵ - 1) = 16 × 31 = 496
p = 7: 2⁶ × (2⁷ - 1) = 64 × 127 = 8128
```

---

## 相關數論概念

### 親和數 (Amicable Numbers)

兩個數 a 和 b，若 a 的真因數和等於 b，且 b 的真因數和等於 a。

```
220 和 284 是一對親和數
σ(220) - 220 = 284
σ(284) - 284 = 220
```

### 半完美數 (Semiperfect)

能用部分真因數相加得到自身的數。

```
12 = 2 + 4 + 6  (半完美數)
```

### 奇異數 (Weird Number)

盈數中無法用真因數子集相加得到自身的數。

```
70 是最小的奇異數
```

---

## 技術規格

| 項目 | 說明 |
|------|------|
| **Worker 類型** | Dedicated Worker |
| **通訊模式** | postMessage |
| **核心演算法** | 因數和計算、子集和判斷 |
| **大數處理** | BigInt |
| **時間複雜度** | O(√n) 計算因數 |
| **難度等級** | 初級 |

---

## 檔案結構

```
007-perfect-number/
├── index.html      # 主頁面
├── main.js         # 主執行緒腳本
├── worker.js       # Web Worker 腳本
├── style.css       # 樣式表
└── README.md       # 說明文件
```

---

## 使用方式

### 本地運行

```bash
npx serve .
# 或
python -m http.server 8000
```

訪問：`http://localhost:8000/examples/01-computation/007-perfect-number/`

### 操作說明

1. **檢測分類**：輸入數字，判斷是完美數、盈數還是虧數
2. **詳細分析**：顯示因數列表和特殊性質
3. **搜尋完美數**：在指定範圍內搜尋所有完美數
4. **分類統計**：統計範圍內各類型數字的分布
5. **梅森完美數**：列出由梅森質數產生的完美數

---

## Worker 通訊模式

### 訊息格式

```javascript
{ type: string, payload: any }
```

### 主執行緒 → Worker

| 類型 | 說明 | Payload |
|------|------|---------|
| `CHECK_SINGLE` | 檢測單數 | `{ number }` |
| `ANALYZE_NUMBER` | 詳細分析 | `{ number }` |
| `SEARCH_RANGE` | 搜尋完美數 | `{ start, end }` |
| `CLASSIFY_RANGE` | 分類統計 | `{ start, end }` |
| `FIND_MERSENNE_PERFECT` | 梅森完美數 | `{ maxExponent }` |
| `STOP` | 停止計算 | - |

### Worker → 主執行緒

| 類型 | 說明 |
|------|------|
| `PROGRESS` | 進度更新 |
| `SINGLE_RESULT` | 單數結果 |
| `ANALYZE_RESULT` | 分析結果 |
| `SEARCH_RESULT` | 搜尋結果 |
| `CLASSIFY_RESULT` | 分類結果 |
| `MERSENNE_RESULT` | 梅森結果 |
| `ERROR` | 錯誤訊息 |

---

## 效能數據

### 單數檢測

| 數字大小 | 耗時 |
|----------|------|
| 10⁶ | ~5ms |
| 10⁸ | ~50ms |
| 10¹⁰ | ~500ms |

### 範圍搜尋

| 範圍 | 耗時 |
|------|------|
| 1 - 10,000 | ~100ms |
| 1 - 100,000 | ~1s |
| 1 - 1,000,000 | ~10s |

---

## 數字分布統計

在 1 到 10,000 的範圍內：

| 分類 | 數量 | 比例 |
|------|------|------|
| 完美數 | 4 | 0.04% |
| 虧數 | 7,508 | 75.08% |
| 盈數 | 2,488 | 24.88% |

---

## 瀏覽器支援

| 功能 | Chrome | Firefox | Safari | Edge |
|------|--------|---------|--------|------|
| Web Workers | 4+ | 3.5+ | 4+ | 12+ |
| BigInt | 67+ | 68+ | 14+ | 79+ |

---

## 相關連結

- [MDN - Web Workers](https://developer.mozilla.org/zh-TW/docs/Web/API/Web_Workers_API)
- [完美數 - 維基百科](https://zh.wikipedia.org/wiki/完美数)
- [梅森質數 - 維基百科](https://zh.wikipedia.org/wiki/梅森素数)
- [GIMPS - 梅森質數搜尋計畫](https://www.mersenne.org/)

---

## 相關範例

- **#006 質因數分解** - 計算因數的基礎
- **#008 梅森質數** - 深入探索梅森質數

---

<p align="center">
  <b>Awesome Web Workers Examples 1000</b><br>
  範例 #007 - 完美數檢測器
</p>
