# Worker 隔離執行 (Isolated Execution)

本範例展示如何利用 Web Workers 建立一個隔離的執行環境（沙箱），用於執行不可信或動態生成的 JavaScript 程式碼。

## 功能特點

1.  **獨立執行緒**：程式碼在獨立的 Worker 執行緒中運行，即使發生無窮迴圈或長時間阻塞，也不會凍結主頁面 UI。
2.  **作用域限制**：透過 `Function` 建構子和變數遮蔽（Shadowing）技術，限制 Worker 內部對敏感全局變數（如 `self`, `postMessage`）的存取。
3.  **執行超時**：主執行緒可以設定超時時間，若 Worker 執行超過限制時間，將被強制終止 (`terminate()`)。
4.  **輸出攔截**：重寫 `console.log` 等方法，將 Worker 內的輸出即時回傳顯示在主頁面上。

## 技術重點

-   **Worker 生命週期管理**：動態創建和銷毀 Worker 實例以確保每次執行都是乾淨的環境。
-   **沙箱化 (Sandboxing)**：
    -   使用 `new Function` 建立獨立作用域。
    -   傳入自定義的 `console` 對象以攔截輸出。
    -   在程式碼頭部宣告 `undefined` 來遮蔽 `self`, `window` 等全局變數。
-   **錯誤處理**：捕獲語法錯誤和執行時錯誤，並回報給用戶。
-   **通訊機制**：使用 `postMessage` 傳遞程式碼與接收執行結果。

## 使用方式

1.  在左側編輯器中輸入 JavaScript 程式碼。
2.  設定「超時限制」（預設 1000ms）。
3.  點擊「執行程式碼」。
4.  觀察下方控制台輸出。
5.  若程式碼執行時間過長，可點擊「強制終止」或等待自動超時。

## 隔離限制說明

雖然本範例展示了基本的隔離技術，但在瀏覽器環境中完全隔離 JavaScript 仍具有挑戰性。此範例主要防止意外的全局變數污染和 UI 阻塞。對於極高安全性需求的場景（如執行惡意程式碼分析），建議配合 iframe sandbox 或伺服器端沙箱使用。
