let agents=[],target={x:700,y:400},width=800,height=500,interval;const colors=['#4a9eff','#28a745','#dc3545','#17a2b8','#6f42c1'];
self.onmessage=e=>{if(e.data.type==='START'){width=e.data.payload.width;height=e.data.payload.height;agents=Array.from({length:10},(_,i)=>({x:50+Math.random()*100,y:50+Math.random()*400,vx:0,vy:0,color:colors[i%colors.length]}));if(interval)clearInterval(interval);interval=setInterval(update,1000/60);}if(e.data.type==='TARGET')target=e.data.payload;};
function update(){for(const a of agents){let dx=target.x-a.x,dy=target.y-a.y,d=Math.hypot(dx,dy);if(d>5){a.vx+=(dx/d)*0.1;a.vy+=(dy/d)*0.1;}for(const o of agents){if(o===a)continue;const ox=a.x-o.x,oy=a.y-o.y,od=Math.hypot(ox,oy);if(od<30&&od>0){a.vx+=(ox/od)*0.2;a.vy+=(oy/od)*0.2;}}const s=Math.hypot(a.vx,a.vy);if(s>3){a.vx=(a.vx/s)*3;a.vy=(a.vy/s)*3;}a.vx*=0.95;a.vy*=0.95;a.x+=a.vx;a.y+=a.vy;a.x=Math.max(12,Math.min(width-12,a.x));a.y=Math.max(12,Math.min(height-12,a.y));}self.postMessage({type:'STATE',payload:{agents:agents.map(a=>({x:a.x,y:a.y,color:a.color})),target}});}
