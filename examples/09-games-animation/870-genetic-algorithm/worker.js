let target='',population=[],generation=0,interval;const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz ';
self.onmessage=e=>{target=e.data.target;population=Array.from({length:e.data.population},()=>randomString(target.length));generation=0;if(interval)clearInterval(interval);interval=setInterval(evolve,50);};
function randomString(len){return Array.from({length:len},()=>chars[Math.floor(Math.random()*chars.length)]).join('');}
function fitness(s){let score=0;for(let i=0;i<s.length;i++)if(s[i]===target[i])score++;return score/target.length;}
function evolve(){generation++;population.sort((a,b)=>fitness(b)-fitness(a));const best=population[0];const bestFit=fitness(best);if(bestFit>=1){clearInterval(interval);self.postMessage({generation,best,fitness:bestFit});return;}const newPop=[best];while(newPop.length<population.length){const p1=population[Math.floor(Math.random()*population.length/2)];const p2=population[Math.floor(Math.random()*population.length/2)];let child='';for(let i=0;i<target.length;i++){child+=Math.random()<0.5?p1[i]:p2[i];if(Math.random()<0.02)child=child.slice(0,-1)+chars[Math.floor(Math.random()*chars.length)];}newPop.push(child);}population=newPop;self.postMessage({generation,best,fitness:bestFit});}
