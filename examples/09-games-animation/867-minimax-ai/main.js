let worker=null,canvas,ctx,board=[],gameOver=false;
document.addEventListener('DOMContentLoaded',()=>{canvas=document.getElementById('gameCanvas');ctx=canvas.getContext('2d');document.getElementById('newGameBtn').addEventListener('click',newGame);canvas.addEventListener('click',handleClick);newGame();});
function newGame(){board=['','','','','','','','',''];gameOver=false;document.getElementById('status').textContent='Your turn (X)';render();}
function render(){ctx.fillStyle='#1a1a2e';ctx.fillRect(0,0,300,300);ctx.strokeStyle='#4a9eff';ctx.lineWidth=3;for(let i=1;i<3;i++){ctx.beginPath();ctx.moveTo(i*100,0);ctx.lineTo(i*100,300);ctx.stroke();ctx.beginPath();ctx.moveTo(0,i*100);ctx.lineTo(300,i*100);ctx.stroke();}ctx.font='60px Arial';ctx.textAlign='center';for(let i=0;i<9;i++){const x=(i%3)*100+50,y=Math.floor(i/3)*100+65;ctx.fillStyle=board[i]==='X'?'#28a745':'#dc3545';ctx.fillText(board[i],x,y);}}
function handleClick(e){if(gameOver)return;const rect=canvas.getBoundingClientRect(),c=Math.floor((e.clientX-rect.left)/100),r=Math.floor((e.clientY-rect.top)/100),i=r*3+c;if(board[i])return;board[i]='X';render();if(checkWin('X')){document.getElementById('status').textContent='You win!';gameOver=true;return;}if(board.every(c=>c)){document.getElementById('status').textContent='Draw!';gameOver=true;return;}document.getElementById('status').textContent='AI thinking...';if(worker)worker.terminate();worker=new Worker('worker.js');worker.onmessage=e=>{board[e.data.move]='O';render();if(checkWin('O')){document.getElementById('status').textContent='AI wins!';gameOver=true;}else if(board.every(c=>c)){document.getElementById('status').textContent='Draw!';gameOver=true;}else document.getElementById('status').textContent='Your turn (X)';};worker.postMessage({board});}
function checkWin(p){const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];return wins.some(w=>w.every(i=>board[i]===p));}
